imageInput.addEventListener('change', async (event) => {
  const files = Array.from(event.target.files);
  if (!files.length) return;

  // 썸네일 초기화
  previewDiv.innerHTML = '';
  resultTableBody.innerHTML = '<tr><td colspan="4">OCR 처리 중...</td></tr>';
  allData = [];

  for (const file of files) {
    // 썸네일 표시
    const thumb = document.createElement('img');
    thumb.src = URL.createObjectURL(file);
    previewDiv.appendChild(thumb);

    // 이미지 디코딩
    const img = new Image();
    img.src = URL.createObjectURL(file);
    await img.decode();

    // OCR 실행
    const rows = await recognizeImage(img, ocrService);

    // 테이블에 결과 추가
    rows.forEach(cells => {
      allData.push(cells);
      const tr = document.createElement('tr');
      cells.forEach(c => {
        const td = document.createElement('td');
        td.textContent = c;
        tr.appendChild(td);
      });
      resultTableBody.appendChild(tr);
    });
  }

  // 합계 계산
  const total = allData.reduce((sum,row)=>sum+(parseInt(row[2])||0),0);
  totalAmountTd.textContent = total.toLocaleString();
});
